# Установка DVC

DVC можно установить несколькими способами? Которые указаны на [официальном сайте](https://dvc.org/doc/install).
В данном руководстве мы рассмотрим случай установки с использованием `pip`.

При использовании `pip` или `conda` необходимо установить пакеты с поддержкой `s3` удаленных хранилищ:
```bash
pip install "dvc[s3]" # Для pip
conda install -c conda-forge dvc-s3 # Для conda
```

DVC можно устанавливать как в систему, так и в виртуальную среду python.

# Создание нового проекта

## Инициализация

DVC сам по себе не занимается версионированием данных, вместо этого он использует git.

Поэтому первым делом в корневой директории проекта необходимо инициализировать новый git репозиторий

```bash
git init
```

, или клонировать существующий без DVC

```bash
git clone [url удаленного репозитория]
```

После этого инициализируем DVC:

```bash
dvc init
```

Далее настроим удаленное хранилище для DVC

```bash
# Добавляем новое удаленное хранилище
dvc remote add spbstu-applied-math-yandex s3://202207dvc/projects/[имя_вашего_репозитория]

# Указываем адрес серверов
dvc remote modify spbstu-applied-math-yandex endpointurl https://storage.yandexcloud.net

# Сделаем хранилищем по умолчанию
dvc remote default spbstu-applied-math-yandex
```

Осталось [добавить ключ доступа](#добавление-ключа-доступа).

# Добавление ключа доступа

Для доступа к хранилищу вам необходимо получить ключ доступа на кафедре:

```bash
dvc remote modify --local spbstu-applied-math-yandex access_key_id "[идентификатор_ключа]"
dvc remote modify --local spbstu-applied-math-yandex secret_access_key "[секретный_ключ]"
```

Обязательно установите параметр `--local`, так как иначе ключ может попасть в общий конфиг и будет загружен на GitHub.

Имя хранилища может быть не `spbstu-applied-math-yandex`. В этом случае его можно найти командой `dvc remote list`, его адрес должен начинаться с `"s3://202207dvc/projects/"`

#

После этого можно начинать работу с системой контроля данных.
Краткие туториалы можно найти [здесь](https://dvc.org/doc/start), а справку по командам [тут](https://dvc.org/doc/command-reference).

Краткие сведения о базовых командах будут [приведены далее](#основы-использования).

# Клонирование существующего проекта

Если вы клонировали проект, который уже добавлен в систему, то вам остается лишь [добавить ключ доступа](#добавление-ключа-доступа) сделать pull

```bash
dvc pull
```

# Основы использования

Файлы которые хранит DVC можно разделить на два вида:

* Файлы, которые генерируются в ходе эксперимента (обученные модели, метрики, таблицы, графики и т.п.). Они версионируются файлами `dvc.lock`

* Остальные файлы, которые поступают в эксперимент извне, либо просто версионируются независимо от экспериментов (датасеты, предобученные модели, результаты других экспериментов). Они версионируются файлами `*.dvc`

## `dvc add`

Если вы не хотите использовать систему пайплайнов (конвейеров), предоставляемую DVC, и всё что вам необходимо - хранить и версионировать большие файлы, то этого способа хранения вам будет достаточно.

Предположим, что вы обучили модель и сохранили её в файл `model.h5`.
Для того, чтобы сохранить текущую версию этого файла выполните:

```bash
dvc add model.h5
```

При этом выполнятся следующие действия:

* Будет вычислен хеш файла
* Файл будет скопирован в `.dvc/cache` с именем, соответствующем его хешу
* Рядом с исходным файлом `model.h5` будет создан файл `model.h5.dvc`, содержащей хеш и другую информацию о файле
* Файл `model.h5` будет добавлен в `.gitignore`

Теперь вместо исходного файла можно отслеживать файл `model.h5.dvc` при помощи `git`.

Если вы хотите версионировать всю папку целиком, например у вас есть датасет `data/test_dataset`

[Подробнее](https://dvc.org/doc/command-reference/add)

## `dvc checkout`

При переключении между коммитами гита будут меняться и отслеживаемые им `*.dvc` файлы. Для того, чтобы получить исходный файл, соответствующий новому `*.dvc` файлу, достаточно использовать команду

```bash
dvc checkout
```

[Подробнее](https://dvc.org/doc/command-reference/checkout)

## `dvc push`

[Подробнее](https://dvc.org/doc/command-reference/push)

## `dvc pull`

[Подробнее](https://dvc.org/doc/command-reference/pull)

## `dvc stage add`

[Подробнее](https://dvc.org/doc/command-reference/stage/add)

## `dvc dag`

[Подробнее](https://dvc.org/doc/command-reference/dag)

## `dvc repro`

[Подробнее](https://dvc.org/doc/command-reference/repro)

## `dvc metrics show`

[Подробнее](https://dvc.org/doc/command-reference/metrics/show)
